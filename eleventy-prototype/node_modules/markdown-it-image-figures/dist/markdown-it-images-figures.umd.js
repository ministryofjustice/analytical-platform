!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t||self).markdownItImageFigures=e()}(this,function(){const t=new Set([!0,!1,"alt","title"]);function e(t,e){return(Array.isArray(t)?t:[]).filter(([t])=>t!==e)}function n(t,n){t&&t.attrs&&(t.attrs=e(t.attrs,n))}function i(e,i){if(!t.has(e))throw new TypeError(`figcaption must be one of: ${[...t]}.`);if("alt"===e)return i.content;const r=i.attrs.find(([t])=>"title"===t);return Array.isArray(r)&&r[1]?(n(i,"title"),r[1]):void 0}return function(t,r){r=r||{},t.core.ruler.before("linkify","image_figures",function(s){let o=1;for(let a=1,c=s.tokens.length;a<c-1;++a){const l=s.tokens[a];if("inline"!==l.type)continue;if(!l.children||1!==l.children.length&&3!==l.children.length)continue;if(1===l.children.length&&"image"!==l.children[0].type)continue;if(3===l.children.length){const[t,e,n]=l.children;if("link_open"!==t.type||"image"!==e.type||"link_close"!==n.type)continue}if(0!==a&&"paragraph_open"!==s.tokens[a-1].type)continue;if(a!==c-1&&"paragraph_close"!==s.tokens[a+1].type)continue;const f=s.tokens[a-1];let p;if(f.type="figure_open",f.tag="figure",s.tokens[a+1].type="figure_close",s.tokens[a+1].tag="figure",r.dataType&&s.tokens[a-1].attrPush(["data-type","image"]),r.link&&1===l.children.length){[p]=l.children;const t=new s.Token("link_open","a",1);t.attrPush(["href",p.attrGet("src")]),l.children.unshift(t),l.children.push(new s.Token("link_close","a",-1))}if(p=1===l.children.length?l.children[0]:l.children[1],r.figcaption){const n=i(r.figcaption,p);if(n){const[i]=t.parseInline(n,s.env);l.children.push(new s.Token("figcaption_open","figcaption",1)),l.children.push(...i.children),l.children.push(new s.Token("figcaption_close","figcaption",-1)),p.attrs&&(p.attrs=e(p.attrs,"title"))}}if(r.copyAttrs&&p.attrs){const t=!0===r.copyAttrs?"":r.copyAttrs;f.attrs=p.attrs.filter(([e])=>e.match(t)).map(t=>Array.from(t))}if(r.tabindex&&(s.tokens[a-1].attrPush(["tabindex",o]),o++),r.lazy&&(p.attrs.some(([t])=>"loading"===t)||p.attrs.push(["loading","lazy"])),r.async&&(p.attrs.some(([t])=>"decoding"===t)||p.attrs.push(["decoding","async"])),r.classes&&"string"==typeof r.classes){let t=!1;for(let e=0,n=p.attrs.length;e<n&&!t;e++){const n=p.attrs[e];"class"===n[0]&&(n[1]=`${n[1]} ${r.classes}`,t=!0)}t||p.attrs.push(["class",r.classes])}if(r.removeSrc){const t=p.attrs.find(([t])=>"src"===t);p.attrs.push(["data-src",t[1]]),n(p,"src")}}})}});
